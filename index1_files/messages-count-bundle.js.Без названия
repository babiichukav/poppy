var __SPOTIM__;(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const n=window.__SPOTIM__.lib.react;var o=e.n(n);const a=window.__SPOTIM__.lib.ReactDom;var r=e.n(a);const i=window.__SPOTIM__.SERVICES.configProvider;var s=e.n(i);function d({counter:e}){return o().createElement("div",{className:"messages-count",onClick:function(){const e=document.querySelector('div[data-spotim-app="conversation"]');e&&e.scrollIntoView()}},o().createElement("a",{href:"javascript:void(0)"},e))}function c({spotId:e,postId:t,counterMessage:n}){return n<0?null:o().createElement(d,{counter:n})}const u=window.__SPOTIM__.lib.request;var l=e.n(u);window.__SPOTIM__.lib.pubSub;var m,v,p,f,_,b,h,y;function S(e){var t=e.element,n=e.onAttributesChanged;t&&MutationObserver&&new MutationObserver((function(e){var t=e.filter((function(e){return"attributes"===e.type&&e.attributeName}));if(t.length>0){var o,a=null==(o=t.find((function(e){return e.target})))?void 0:o.target;null==n||n(a,t)}})).observe(t,{attributes:!0})}function w(e){var t=e.element,n=e.onRemoved;t&&MutationObserver&&t.parentNode&&new MutationObserver((function(e,o){e.some((function(e){return Array.from(e.removedNodes).indexOf(t)>-1}))&&(n(e[0].removedNodes[0]),o.disconnect())})).observe(t.parentNode,{childList:!0})}async function I(e){let t=document.querySelectorAll("[data-spotim-module=messages-count]");if(0===t.length&&(t=document.querySelectorAll(".spot-im-replies-count")),t.length){const n=[],a=s().get("spotId");async function i(){const i=await l()("v1.0.0/conversation/count",{method:"POST",headers:{"Content-Type":"application/json","x-spot-id":a,"x-post-id":"default"},body:JSON.stringify({conversation_ids:n})});Object.keys(t).forEach((n=>{const s=t[n].dataset.postId;if(!e||e===s){const e=i.counts[`${a}_${s}`].comments,d=i.counts[`${a}_${s}`].replies,u=parseInt(e)+parseInt(d);a&&s&&r().render(o().createElement(c,{spotId:a,postId:s,counterMessage:u}),t[n])}}))}Object.keys(t).forEach((o=>{const r=t[o].dataset.postId;e&&e!==r||n.push(`${a}_${r}`)})),i()}}v=(m={selector:"[data-spotim-module=messages-count],[class=spot-im-replies-count]",onAdded:e=>{},onAttributesChanged:(e,t)=>{const n=t.map((e=>e.attributeName)).includes("data-post-id"),o=e.dataset.postId;n&&o&&I(o)},onRemoved:()=>{}}).selector,p=m.onAdded,_=void 0===(f=m.onAttributesChanged)?function(){}:f,h=void 0===(b=m.onRemoved)?function(){}:b,y="spotim-detector-animation-"+function(e){if(!e)return 0;for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t+Math.floor(1e5+9e5*Math.random())||0}(v),window.top!==window&&window.$sf?function(e){var t=e.selector,n=e.onItemFound,o=document.querySelector(t);if(o)n(o);else var a=setInterval((function(){var e=document.querySelector(t);e&&(n(e),clearInterval(a))}),1e3)}({selector:v,onItemFound:function(e){p(e),w({element:e,onRemoved:h}),S({element:e,onAttributesChanged:_})}}):(function(e){var t=e.selector,n=e.animationName;requestAnimationFrame((function(){var e,o=document.createElement("style");o.setAttribute("data-spot-im-style-module","*"),o.setAttribute("data-spot-im-style","true"),o.innerText=("\n  "+t+" {\n    animation: "+n+" 1ms !important;\n  }\n  \n  @keyframes "+n+" {\n    from {\n    } to {\n    }\n  }\n  ").replace(/\n/g,""),document.head.appendChild(o),(null==(e=window.__SPOTIM__)?void 0:e.stylesheetElementAdded)&&window.__SPOTIM__.stylesheetElementAdded({module:"*",stylesheetElement:o});var a=document.querySelectorAll("data-spot-im-shadow-host");Array.from(a).forEach((function(e){e.shadowRoot&&e.shadowRoot.appendChild(o.cloneNode())}))}))}({animationName:y,selector:v}),function(e){var t=e.animationName,n=e.onItemFound,o=function(e){var o;e.animationName!==t&&(null==e||null==(o=e.detail)?void 0:o.animationName)!==t||!e.target||n&&n(e.composedPath()[0])};document.addEventListener("animationstart",o),document.addEventListener("MSAnimationStart",o),document.addEventListener("webkitAnimationStart",o)}({animationName:y,onItemFound:function(e){p(e),w({element:e,onRemoved:h}),S({element:e,onAttributesChanged:_})}})),I(),(__SPOTIM__=void 0===__SPOTIM__?{}:__SPOTIM__).apps=t})();
//# sourceMappingURL=messages-count-bundle.js.map